// API Authentication Actions.

import { FETCH_AUTH_TOEKN } from "../../action-types";
import { GET_AUTH_TOKEN } from "../../getter-types";
import { SAVE_AUTH_TOKEN_SATE } from "../../mutation-types";
import authApi from "../../../api/authentication-api";
import sesionManager from "../../../helpers/session-manager";
import appConfig from "../../../config.json";

export default {
  // fetch current basket result
  [FETCH_AUTH_TOEKN]: (context, HeaderOptions) =>
    new Promise((resolve, reject) => {
      const headerOptions = HeaderOptions;
      if (!sesionManager.chekcCookieExsitst(appConfig.Cookiekeys.IsValidToken)) {
        const authToken = context.getters.GET_AUTH_TOKEN;
        /* if (authToken && authToken.refresh_token) {
          headerOptions.grantType = "refresh_token";
          headerOptions.refresh_token = authToken.refresh_token;
        } */

        authApi
          .getToken(headerOptions)
          .then((token) => {
            context.commit(SAVE_AUTH_TOKEN_SATE, token);
            sesionManager.setCookie(appConfig.Cookiekeys.IsValidToken, true, token.expires_in);
            resolve();
          })
          .catch((error) => {
            reject();
            throw error;
          });
      } else {
        resolve();
      }
    })
};
